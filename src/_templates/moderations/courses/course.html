{% extends 'moderations/base.html' %}
{% load static i18n %}
{% block title %}{{ seo_title }}{% endblock title %}
{% block description %}{{ seo_description }}{% endblock description %}
{% block propertytitle %}{% if seo_previev %}{{ seo_previev.url }} {% endif %} {% endblock propertytitle %}
{% block propertydescription %}{{ seo_propertytitle }}{% endblock propertydescription %}
{% block propertyimage %}{{ seo_propertydescription }}{% endblock propertyimage %}
{% block head %}

{% endblock head %}
{% block content %}
<div class="user-profile">
    <div class="row">
        <!-- user profile first-style start-->
        <div class="col-sm-12">
            <div class="card hovercard text-center">
                <div class="cardheader" style="background: url({% if course.cover %}{{course.cover.url}}{% else %}../images/other-images/bg-profile.png{% endif %}) 10% center / cover; height: 200px;"></div>
                <div class="info">
                    <div class="row">
                        <div class="col-6">
                            <div class="row g-3">
                                <div class="col-md-12">
                                    <div class="text-md-start">
                                        <div class="title">
                                            <a>
                                                {{course.name}}
                                            </a>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="d-flex" style="position: absolute; right: 0;">
                                <div style="padding-right: 5px;" class="text-md-end border-right">
                                    <div class="follow-num counter" data-target="{{ course.courserewievs_set.count }}">{{ course.courserewievs_set.count }}</div><span>Отзывов</span>
                                </div>
                                <div class="text-md-start" style="padding-left: 5px;">
                                    <div class="follow-num counter" data-target="{{ course.coursecomments_set.count }}">{{ course.coursecomments_set.count }}</div><span>Комментариев</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <ul class="nav nav-tabs border-tab tabs-scoial" id="top-tab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'moderation:course' course.slug %}">Информация</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'moderation:coursecomment' course.slug %}">Комментарии</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'moderation:coursereviews' course.slug %}">Отзывы</a>
                        </li>
                        <li>
                            {% if course.price <= 0 %}
                            <a class="btn bg-primary btn-hover-effect" href="{#% url 'course_detail' course.id %#}">
                                <i class="fa-solid fa-play me-2"></i>
                                Пройти бесплатно
                            </a>
                            {% elif course.has_courseuser %}
                            <a class="btn bg-success btn-hover-effect"
                               href="{% url 'moderation:coursepassing' course.id %}">
                                <i class="fa-solid fa-check me-2"></i>
                                Продолжить обучение
                            </a>
                            {% elif course.id in user_courses %}
                            <a class="btn bg-warning btn-hover-effect" href="{#% url 'course_detail' course.id %#}">
                                <i class="fa-solid fa-exclamation-triangle me-2"></i>
                                Завершить оплату
                            </a>
                            {% else %}
                            <a class="btn bg-primary btn-hover-effect" href="#" data-bs-toggle="modal"
                               data-bs-target="#paymentModal{{ course.id }}">
                                <i class="fa-solid fa-cart-shopping me-2"></i>
                                Купить за {{ course.price }} руб.
                            </a>
                            {% endif %}
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- user profile first-style end-->
        <div class="col-xl-3 xl-40 col-lg-6 col-md-5 box-col-4">
            <div class="default-according style-1 faq-accordion" id="accordionExample">
                {% for module_data in modules_with_themes %}
                <div class="card">
                    <div class="card-header" id="heading{{ module_data.id }}">
                        <h2 class="mb-0">
                            <button class="btn btn-link btn-block text-start collapsed"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#collapse{{ module_data.id }}"
                                    aria-expanded="false"
                                    aria-controls="collapse{{ module_data.id }}">
                                {{ module_data.name }}
                            </button>
                        </h2>
                    </div>
                    <div class="collapse" id="collapse{{ module_data.id }}"
                         aria-labelledby="heading{{ module_data.id }}" data-bs-parent="#accordionExample">
                        <div class="card-body socialprofile filter-cards-view">
                            <div class="card-body social-status filter-cards-view">
                                {% for theme in module_data.themes_list %}
                                {% if theme %}
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <span class="f-w-600 d-block">{{ theme.name }}</span>
                                        <span class="d-block fw-normal">Вопросов: {{ theme.quizzes.count }}</span>
                                    </div>
                                </div>
                                {% else %}
                                <div class="d-flex">
                                    <div class="flex-grow-1">
                                        <span class="f-w-600 d-block">Нет лекций</span>
                                    </div>
                                </div>
                                {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="col-xl-9 xl-60 col-lg-6 col-md-7 box-col-8">
            <div class="row">
                <div class="col-sm-12">
                    <div class="card">
                        <div class="card-body">
                            {{ course.description|safe }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade modal-bookmark" id="paymentModal{{ course.id }}" tabindex="-1"
     aria-labelledby="paymentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="paymentModalLabel">Оплата курса: {{ course.name }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p><strong>Описание:</strong> {{ course.description|safe }}</p>
                <p><strong>Цена:</strong> {{ course.price }} руб.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
                <form action="{% url 'moderation:course_payment' course.id %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary">Оплатить</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
{% block footer %}
{% endblock footer %}