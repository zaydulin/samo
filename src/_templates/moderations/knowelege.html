{% extends 'moderations/base.html' %}
{% load static  %}
{% load i18n %}
{% block title %}{{ seo_title }}{% endblock title %}
{% block description %}{{ seo_description }}{% endblock description %}
{% block propertytitle %}{% if seo_previev %}{{ seo_previev.url }} {% endif %} {% endblock propertytitle %}
{% block propertydescription %}{{ seo_propertytitle }}{% endblock propertydescription %}
{% block propertyimage %}{{ seo_propertydescription }}{% endblock propertyimage %}
{% block head %}{% endblock head %}
{% block content %}
<!-- Add Project -->
<div class="card">
    <div class="card-header">
    <div class="row">
        <h4 class="card-title col-6">{% trans 'База знаний' %}</h4>
        <div class="toolbar1 col-6 text-end" role="toolbar">
            <div class="btn-group mb-1">
                    <button type="button" class="btn btn-primary light px-3" onclick="location.href=`{% url 'moderation:knowledge' %}`">
                        <i class="fa fa-refresh"></i>
                    </button>
                </div>
                <div class="btn-group mb-1" style="margin-right: 20px;">
                    <button type="button" class="btn btn-primary light dropdown-toggle v" data-bs-toggle="dropdown">
                        {% trans 'Поиск по' %}
                        <span class="caret m-l-5"></span>
                    </button>
                    <div class="dropdown-menu">
                        <a class="dropdown-item" href="javascript:void(0);" onclick="openSearch('name')">{% trans 'Название' %}</a>
                    </div>
                </div>
                <div class="btn-group mb-1">
                    {% include 'moderations/include/paginations.html' with items=knowelege_list %}
                </div>
            </div>
    </div>
    </div>
    <div class="card-body">
        <div class="row">
    <div class="col-xl-4 mb-4">
    <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-indicators">
            {% for file in files %}
            <button type="button" data-bs-target="#carouselExampleIndicators"
                    data-bs-slide-to="{{ forloop.counter0 }}"
                    class="{% if forloop.first %}active{% endif %}"
                    aria-current="{% if forloop.first %}true{% endif %}"
                    aria-label="Slide {{ forloop.counter }}"></button>
            {% endfor %}
        </div>
        <div class="carousel-inner" style="text-align: center">
            {% for file in files %}
            <div class="carousel-item {% if forloop.first %}active{% endif %}">
                <div class="d-block w-100" style="min-height: 500px; background-image: url({% if file.file %}{{ file.file.url }}{% endif %}); background-size: contain; background-position: center; background-repeat: no-repeat; display: flex; align-items: center; justify-content: center; flex-direction: column; padding: 15px;border-radius: 0.375rem;">
                    <div class="mb-3" style=" position: absolute; bottom: 0; ">
                        <a href="{{ file.file.url }}" class="btn btn-primary" target="_blank" style="margin-top: 10px">{% trans 'Посмотреть' %}</a>
                        <a href="{{ file.file.url }}" class="btn btn-secondary" download style="margin-top: 10px">{% trans 'Скачать' %}</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators"
                data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">{% trans 'Прошлая' %}</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators"
                data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">{% trans 'Следующая' %}</span>
        </button>
    </div>
</div>

    <div class="col-xl-8">
        <div class="media-body">
            {% for item in knowelege_list %}
                <h5 class="mt-0">{{ item.name }}</h5>
                <p class="mb-0">{{ item.description }}</p>
            {% endfor %}
        </div>
    </div>
</div>

    </div>
</div>
<div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="searchModalLabel">{% trans 'Поиск' %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="idSearchName" style="display: none;">
                    <input type="text" id="searchInputName" class="form-control" placeholder="{% trans 'Введите название' %}">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans 'Закрыть' %}</button>
                <button type="button" class="btn btn-primary" onclick="performSearch()">{% trans 'Поиск' %}</button>
            </div>
        </div>
    </div>
</div>
<style>
    .table{
        width: 100%;
    }
    .card{
        margin-top: 1.25rem;
    }
</style>
<script>
    function openSearch(type) {
        const modalLabel = document.getElementById('searchModalLabel');
        modalLabel.textContent = type === 'name' ? '{% trans "Поиск по названию" %}' : '';

        document.getElementById('idSearchName').style.display = 'none';

        switch (type) {
            case 'name':
                document.getElementById('idSearchName').style.display = 'block';
                break;
        }

        $('#searchModal').modal('show');
    }

    function performSearch() {
        const searchName = document.getElementById('searchInputName').value;

        // Формируем URL для запроса
        const url = new URL(window.location.href);
        if (searchName) {
            url.searchParams.set('search_name', searchName);
        }

        console.log(url.toString()); // Проверяем, что URL сформирован правильно

        // Перезагружаем страницу с новыми параметрами
        window.location.href = url.toString();

        // Закрыть модальное окно после выполнения поиска
        $('#searchModal').modal('hide');
    }
</script>
{% endblock content %}
{% block footer_extra %}
{% endblock footer_extra %}