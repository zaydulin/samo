{% extends 'moderations/base.html' %}
{% load static %}
{% block title %}{{ seo_title }}{% endblock title %}
{% block description %}{{ seo_description }}{% endblock description %}
{% block propertytitle %}{% if seo_previev %}{{ seo_previev.url }} {% endif %} {% endblock propertytitle %}
{% block propertydescription %}{{ seo_propertytitle }}{% endblock propertydescription %}
{% block propertyimage %}{{ seo_propertydescription }}{% endblock propertyimage %}
{% block head %}{% endblock head %}
{% block left-title %}{% endblock left-title %}
{% block breadcrumb %}{% endblock breadcrumb %}
{% block content %}
<div class="row">
    {% for needcourse in needcourses %}
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>{{ needcourse.name }}</h5>
                <div class="card-header-right">
                    <ul class="list-unstyled card-option">
                        <li>
                            <a type="button" id="{{ needcourse.id }}" data-name="{{ needcourse.name }}" data-bs-toggle="modal" data-bs-target="#InfoModalCenter">
                                <i class="fa-solid fa-gear fa-spin"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="card-body">
                {{ needcourse.description|safe }}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Modal -->
<div class="modal fade" id="InfoModalCenter" tabindex="-1" aria-labelledby="InfoModalCenterLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="needcourse-title">Добавить курс</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Закрыть"></button>
            </div>
            <div class="modal-body">
                <form method="post" action="{% url 'moderation:needcourses' %}">
                    {% csrf_token %}
                    <!-- Скрытое поле для ID курса -->
                    {{ form.needcourse }}
                    <div class="row">
                        <div class="col-sm-12">
                            {{ form.price }}
                        </div>
                        <div class="col-sm-12">
                            {{ form.description }}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Сохранить</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
{% block footer %}
<script src="{% static 'site/_generals/js/bookmark/jquery.validate.min.js' %}"></script>
<script src="{% static 'site/_generals/js/bookmark/custom.js' %}"></script>
<style>
    a.delete-bookmark {
        cursor: pointer;
    }
</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Выбираем все кнопки, которые открывают модальное окно
        const modalButtons = document.querySelectorAll('[data-bs-toggle="modal"]');

        modalButtons.forEach(button => {
            button.addEventListener('click', function () {
                // Получаем данные из атрибутов кнопки
                const needcourseId = this.getAttribute('id');
                const needcourseName = this.getAttribute('data-name');

                // Вставляем название курса в заголовок модального окна
                document.getElementById('needcourse-title').textContent = `Добавить курс для: ${needcourseName}`;

                // Устанавливаем значение скрытого поля 'needcourse'
                const form = document.querySelector('#InfoModalCenter form');
                const needcourseInput = form.querySelector('input[name="needcourse"]');
                if (needcourseInput) {
                    needcourseInput.value = needcourseId;
                }
            });
        });
    });
</script>
{% endblock footer %}
